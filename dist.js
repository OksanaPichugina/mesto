(()=>{"use strict";const e=document.querySelector("#open-popup"),t=document.querySelector("#name-input"),s=document.querySelector("#job-input"),o=document.querySelector("#edit-form"),n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__button-save__inactive",inputErrorClass:"form__input_error",errorClass:"popup__input-error_active"},r=document.querySelector("#add-form"),i=document.querySelector("#open-popup-add-button");class l{constructor(e,t,s){this._text=e.name,this._link=e.link,this._templateSelector=t,this._element=this._getTemplate(),this._elemImage=this._element.querySelector(".element__image"),this._handleCardClick=s,this._buttonLike=this._element.querySelector(".element__like"),this._buttonDelete=this._element.querySelector(".element__delite")}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}getView(){return this._setEventListeners(),this._elemImage.src=this._link,this._element.querySelector(".element__name").querySelector(".element__text").textContent=this._text,this._elemImage.alt=this._text,this._element}remove(){this._element.remove(),this._element=null}like(){this._buttonLike.classList.toggle("element__like_active")}_setEventListeners(){this._elemImage.addEventListener("click",(()=>{this._handleCardClick()})),this._buttonDelete.addEventListener("click",(()=>this.remove())),this._buttonLike.addEventListener("click",(()=>this.like()))}}class c{constructor(e){this._selector=e,this.popup=document.querySelector(this._selector),this._buttonClose=this.popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this.popup.classList.add("popup_opened"),window.addEventListener("keydown",this._handleEscClose)}close(){this.popup.classList.remove("popup_opened"),window.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){27===e.keyCode&&this.close()}setEventListener(){this._buttonClose.addEventListener("click",(()=>this.close())),this.popup.addEventListener("click",(e=>{e.target.classList.contains("popup")&&this.close()}))}}class a extends c{constructor(e,{callback:t}){super(e),this._inputs=this.popup.querySelectorAll(".popup__input"),this._callback=t,this._fom=this.popup.querySelector(".popup__form")}setEventListener(){super.setEventListener(),this.popup.addEventListener("submit",(e=>{e.preventDefault(),this._callback(this._getInputValues())}))}open(){super.open()}close(){super.close(),this._fom.reset()}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,o=t.value;e[s]=o})),e}}class p{constructor(e,t){this._formSelectors=e,this._formElem=t,this._formList=Array.from(this._formElem.querySelectorAll(this._formSelectors.inputSelector)),this._button=this._formElem.querySelector(this._formSelectors.submitButtonSelector)}enableValidation(){this._formElem.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()}_showInputError(e,t){const s=this._formElem.querySelector(`.${e.id}-error`);e.classList.add(this._formSelectors.inputErrorClass),s.textContent=t,s.classList.add(this._formSelectors.errorClass)}_hideInputError=e=>{const t=this._formElem.querySelector(`.${e.id}-error`);e.classList.remove(this._formSelectors.inputErrorClass),t.classList.remove(this._formSelectors.errorClass),t.textContent=""};_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setEventListeners(){this._formList.forEach((e=>{this.toggleButtonState(),e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}_hasInvalidInput(){return this._formList.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput()?(this._button.classList.add(this._formSelectors.inactiveButtonClass),this._button.setAttribute("disabled","true")):(this._button.classList.remove(this._formSelectors.inactiveButtonClass),this._button.removeAttribute("disabled"))}}const u=new p(n,r);u.enableValidation(),new p(n,o).enableValidation(),new class{constructor(e,t){this._url=e,this._headers=t}getAllCards(){return fetch(this._url,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();throw new Error("Что-то пошло не так")})).catch((e=>{console.log(e)}))}}({url:"https://nomoreparties.co/v1/cohort-75/cards ",headers:{authorization:"2f4a0f3f-0cc6-4586-a3d5-35eed1a37f2e","Content-Type":"application/json"}}).getAllCards().then((e=>{console.log(e)}));const h=new class{constructor(e,t){this.name=document.querySelector(e),this.job=document.querySelector(t)}getUserInfo(){return{name:this.name.textContent,job:this.job.textContent}}setUserInfo(e,t){this.name.textContent=e,this.job.textContent=t,console.log(e),console.log(t)}}(".profile__name",".profile__job"),d=new a("#edit-popup",{callback:e=>{h.setUserInfo(e.name,e.job),d.close()}});d.setEventListener(),e.addEventListener("click",(()=>{d.open();const e=h.getUserInfo();t.value=e.name,s.value=e.job}));const _=new class extends c{constructor(e){super(e),this._popupImage=this.popup.querySelector(".popup__image"),this._popupText=this.popup.querySelector(".popup__text")}open(e){super.open(),this._popupImage.src=e.link,this._popupText.textContent=e.name,this._popupImage.alt=e.name}}("#image-popup");function m(e){return new l(e,"#element-template",(()=>{_.open(e),_.setEventListener()})).getView()}const v=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(e){e.forEach((e=>{this._renderer(e)}))}}({renderer:e=>{v.addItem(m(e))}},".elements__list");v.renderItems([{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}]);const f=new a("#add-popup",{callback:e=>{const t={name:e.place,link:e.link};v.addItem(m(t)),f.close(),u.toggleButtonState()}});f.setEventListener(),i.addEventListener("click",(()=>{f.open()}))})();